# fix: シミュレーション履歴が保存されない問題の修正

## 問題
実行したシミュレーションの履歴が保存されていない

## 調査結果
1. **バックエンドの履歴保存機能は正常に動作している**
   - `logs/`ディレクトリに多数の履歴ファイルが保存されている
   - `/api/simulation/history`エンドポイントも正常にデータを返している

2. **問題はフロントエンドの履歴表示にある**
   - `IntegratedInspector.tsx`で履歴タブが`SimulationHistoryTab`を使用している
   - しかし`SimulationHistoryTab`は単純なエクスポート機能のみ
   - 実際の履歴一覧表示は`SimulationTab`コンポーネントに実装されている

3. **シミュレーション停止時の履歴保存問題**
   - `stop_simulation`でIDLE状態の履歴が保存されていない
   - `end_simulation`の履歴保存条件が`_is_running`に依存している
   - 履歴保存前にエンジンが`None`に設定される順序問題

## 修正方針
1. `IntegratedInspector.tsx`の履歴タブで`SimulationTab`コンポーネントを使用するよう修正
2. `SimulationHistoryTab`コンポーネントは削除または名前変更
3. シミュレーション停止時の履歴保存処理を修正

## 実装内容
- ✅ `IntegratedInspector.tsx`の履歴タブを`SimulationTab`に変更（既に修正済み）
- ✅ 不要な`SimulationHistoryTab`コンポーネントを削除
- ✅ `stop_simulation`メソッドでIDLE状態でも履歴保存するよう修正
- ✅ `reset_simulation`メソッドでIDLE状態でも履歴保存するよう修正
- ✅ `end_simulation`メソッドで`_is_running`状態に関係なく履歴保存するよう修正
- ✅ 履歴保存処理の詳細ログを追加

## テスト内容
- ✅ バックエンドAPIの動作確認（正常）
- ✅ フロントエンドプロキシの動作確認（正常）
- 🔄 **ユーザーテスト待ち**: ブラウザで履歴タブを開いて履歴一覧が表示されるか確認
- 🔄 **ユーザーテスト待ち**: シミュレーション停止時に履歴が保存されるか確認

## 確認事項
ブラウザで以下を確認してください：
1. 右ペインの「履歴」タブを開く
2. 左側に履歴一覧が表示されるか
3. 履歴項目をクリックして詳細が表示されるか
4. シミュレーションを実行して停止した時に新しい履歴が追加されるか
5. エラーがある場合は開発者ツールのコンソールを確認 