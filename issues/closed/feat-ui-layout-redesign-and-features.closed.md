# feat: UIレイアウト再設計と機能拡張

## 問題の概要
現在の3カード構成のUIから、より実用的な2カード構成への変更と、実際に使用される機能の実装が必要。

## 現状の問題
- 「リアルタイム表示」カードに実際の機能がない
- Control Panelの機能が限定的
- File Edit機能が未実装
- シーン選択機能がない
- モデル切り替え機能がない
- 介入（Intervention）機能がない

## 新しいUIレイアウト設計
```
┌─────────────────────────────────────────────────────────────┐
│                          Title                              │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────┬───────────────────────────┐
│                                 │                           │
│            Timeline             │      Control Panel       │
│                                 │  Next, Stop, Intervention│
│   デフォルトで現在のタイムライン表示    │  Interventionのときはテキスト入力│
│   過去のタイムラインを表示することも    │   StartのときはSceneの選択      │
│           できる                 │                           │
│                                 ├───────────────────────────┤
│                                 │                           │
│                                 │        File Edit         │
│                                 │ ファイルを選んで、プロンプトの修正、│
│                                 │ YAMLファイルの修正、Sceneファイル│
│                                 │      の修正や追加など        │
│                                 │                           │
└─────────────────────────────────┴───────────────────────────┘
```

## 実装する機能

### 1. Control Panel機能拡張
- **シーン選択機能**: シミュレーション開始時に利用可能なシーンファイルから選択
- **モデル切り替え機能**: OpenAI/Geminiプロバイダーとモデル名の選択
- **介入（Intervention）機能**: 
  - テキスト入力フィールド
  - 介入タイプの選択（状況更新、天啓付与、キャラクター追加/削除など）
- **リアルタイム状態表示**: 現在のターン数、実行中キャラクター名、シミュレーション状態

### 2. File Edit機能実装
- **プロンプトテンプレート編集**: `data/prompts/`内のテンプレートファイルの編集
- **キャラクター設定編集**: `data/characters/*/immutable.yaml`, `long_term.yaml`の編集
- **シーンファイル編集・追加**: `data/scenes/`内のYAMLファイルの編集・新規作成
- **ファイルブラウザ**: ディレクトリ構造の表示とファイル選択
- **構文ハイライト**: YAML、テキストファイルの適切な表示

### 3. UIレイアウト変更
- 3カード構成から2カード構成への変更
- 左側: Timeline（既存機能維持）
- 右側上部: Control Panel（機能拡張）
- 右側下部: File Edit（新規実装）
- レスポンシブ対応

## 実装タスク

### Phase 1: UIレイアウト変更
- [ ] App.tsxの3カード構成を2カード構成に変更
- [ ] レイアウトのCSS調整
- [ ] レスポンシブ対応

### Phase 2: Control Panel機能拡張
- [ ] シーン選択コンポーネントの実装
- [ ] モデル切り替えコンポーネントの実装
- [ ] 介入機能コンポーネントの実装
- [ ] バックエンドAPIの拡張（シーン一覧取得、モデル切り替え、介入処理）

### Phase 3: File Edit機能実装
- [ ] ファイルブラウザコンポーネントの実装
- [ ] ファイル編集エディターコンポーネントの実装
- [ ] バックエンドAPIの実装（ファイル一覧、読み込み、保存）
- [ ] 構文ハイライト機能の追加

### Phase 4: 統合とテスト
- [ ] 全機能の統合テスト
- [ ] UI/UXの最終調整
- [ ] エラーハンドリングの改善

## 技術的詳細

### バックエンドAPI追加
- `GET /api/scenes` - 利用可能なシーンファイル一覧
- `PUT /api/simulation/model` - LLMモデル切り替え
- `POST /api/simulation/intervention` - 介入実行
- `GET /api/files/{path}` - ファイル内容取得
- `PUT /api/files/{path}` - ファイル保存
- `GET /api/files/tree` - ディレクトリ構造取得

### フロントエンド新規コンポーネント
- `SceneSelector.tsx` - シーン選択
- `ModelSelector.tsx` - モデル切り替え
- `InterventionPanel.tsx` - 介入機能
- `FileBrowser.tsx` - ファイルブラウザ
- `FileEditor.tsx` - ファイル編集エディター

## 受け入れ条件
- [ ] UIが提案されたレイアウトに変更されている
- [ ] シーン選択機能が動作する
- [ ] モデル切り替え機能が動作する
- [ ] 介入機能が動作する
- [ ] プロンプト、YAML、シーンファイルの編集・保存が可能
- [ ] 新規シーンファイルの作成が可能
- [ ] レスポンシブデザインが適切に動作する
- [ ] 既存のタイムライン機能が正常に動作する

## 優先度
高 - UIの使いやすさとプロジェクトの実用性に直結する重要な機能群 