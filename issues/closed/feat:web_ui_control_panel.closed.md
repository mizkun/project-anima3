## 1. Issue種別 (Issue Type)

* [x] 新規機能 (New Feature)

## 2. 優先度 (Priority)

* [x] 高 (High)

## 3. タイトル (Title)

Web UIシミュレーション制御パネルの実装

## 4. 問題の概要 (Problem Overview)

Web UIでシミュレーションを制御するため、現在ターミナルで実行可能な全ての操作をボタンやドロップダウンで実行できる制御パネルを実装する必要がある。シミュレーションの開始・停止・次ターン実行、モデル変更、介入機能などを直感的に操作できるインターフェースを提供する。

## 5. 発見バージョン/関連機能 (Version/Related Feature)

* **バージョン**: 現在の開発版
* **関連する詳細仕様書セクション**: Web UI実装方針 - 制御機能
* **関連するタスクリスト番号**: 新規Web UI開発

## 6. 発生条件 / 再現手順 (Conditions / Steps to Reproduce)

N/A (新規機能)

## 7. 期待される動作 (Expected Behavior)

* シミュレーションの開始・停止・次ターン実行がボタンで可能になること
* LLMモデルの変更がドロップダウンで可能になること
* 介入機能（状況更新、天啓付与等）がフォームで実行できること
* シーンの選択がドロップダウンで可能になること
* 現在のシミュレーション状態が視覚的に分かること
* 実行中の操作が適切に無効化されること

## 8. 実際の動作 / 現在の状況 (Actual Behavior / Current Situation)

現在はシミュレーション制御機能が存在しない

---

### 9. 原因調査 / 分析 (Cause Analysis by AI Assistant: Cursor)

* **調査した箇所**:
    * `src/project_anima/interactive_cli.py` - 現在の制御コマンド
    * `src/project_anima/core/simulation_engine.py` - 制御可能な機能
    * Web UI設計要件
* **特定された原因 (仮説を含む)**:
    * Web UI用の制御パネルが存在しない
    * ターミナルコマンドのWeb UI版が実装されていない
    * 状態管理と制御ロジックが分離されていない

### 10. 提案される解決策 / 改善案 (Proposed Solution / Improvement by AI Assistant: Cursor)

* **基本的な方針**:
    * 現在のinteractive_cli.pyの機能をWeb UIで再現
    * 直感的なボタンとフォームで操作を簡素化
    * リアルタイムで状態を反映し、適切な操作制限を実装
    * モダンなUIデザインで使いやすさを向上
* **具体的な変更点**:
    * 制御パネルコンポーネントの実装
    * 各種制御ボタンの実装
    * モデル選択ドロップダウンの実装
    * 介入フォームの実装

### 11. 実装計画 / タスク分割 (Implementation Plan / Sub-tasks by AI Assistant: Cursor)

1. **[ ] 制御パネルコンテナコンポーネントの実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/ControlPanel.tsx`
   * **具体的な変更内容**: 制御パネル全体を管理するメインコンポーネント

2. **[ ] シミュレーション制御ボタンの実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/SimulationControls.tsx`
   * **具体的な変更内容**: 開始・停止・次ターンボタンの実装

3. **[ ] モデル選択ドロップダウンの実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/ModelSelector.tsx`
   * **具体的な変更内容**: LLMモデル選択とリアルタイム変更機能

4. **[ ] シーン選択ドロップダウンの実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/SceneSelector.tsx`
   * **具体的な変更内容**: シーンファイル選択機能

5. **[ ] 介入機能フォームの実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/InterventionForm.tsx`
   * **具体的な変更内容**: 状況更新、天啓付与等の介入フォーム

6. **[ ] ステータス表示コンポーネントの実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/StatusDisplay.tsx`
   * **具体的な変更内容**: 現在のシミュレーション状態表示

7. **[ ] 制御用カスタムフックの実装**
   * **変更対象ファイル**: `web/frontend/src/hooks/useSimulationControls.ts`
   * **具体的な変更内容**: 制御機能の状態管理とAPI通信

8. **[ ] 長期情報更新制御の実装**
   * **変更対象ファイル**: `web/frontend/src/components/Controls/LongTermUpdateControls.tsx`
   * **具体的な変更内容**: キャラクター長期情報更新の制御

### 12. テスト計画 (Test Plan by AI Assistant: Cursor)

* **ユニットテスト**:
    * 各制御コンポーネントの動作テスト
    * カスタムフックの状態管理テスト
    * フォームバリデーションのテスト
* **結合テスト/手動テスト**:
    * 制御パネル全体の動作確認
    * シミュレーション制御の動作確認
    * モデル変更の動作確認
    * 介入機能の動作確認
    * エラーハンドリングの確認

---

## 13. 完了の定義 (Definition of Done)

* [ ] 制御パネルコンテナコンポーネントが実装されている
* [ ] シミュレーション制御ボタンが実装されている
* [ ] モデル選択ドロップダウンが実装されている
* [ ] シーン選択ドロップダウンが実装されている
* [ ] 介入機能フォームが実装されている
* [ ] ステータス表示コンポーネントが実装されている
* [ ] 制御用カスタムフックが実装されている
* [ ] 長期情報更新制御が実装されている
* [ ] 実行中の適切な操作制限が実装されている
* [ ] エラーハンドリングが実装されている
* [ ] レスポンシブデザインに対応している
* [ ] 基本的なテストが実装され、成功する
* [ ] アクセシビリティに配慮されている

## 14. 備考 (Notes)

* 介入機能は段階的に実装し、まず基本的な機能から開始
* モデル変更は実行中でも可能にする
* エラー状態の適切な表示とリカバリ機能を実装
* 将来的にはキーボードショートカットも追加予定 